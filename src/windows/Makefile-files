# -*- Makefile -*-

# The following four lines help debugging the reldir usage
: reldir %reldir%/foo
: canon_reldir %canon_reldir%_bar
: D %D%/bar
: C %C%_foo

if BUILD_FOR_WINDOWS

bin_PROGRAMS                       += %reldir%/npt

%canon_reldir%_npt_CFLAGS           =
%canon_reldir%_npt_CPPFLAGS         =
%canon_reldir%_npt_DEPENDENCIES     =
%canon_reldir%_npt_LDADD            =
%canon_reldir%_npt_SOURCES          =

%canon_reldir%_npt_SOURCES         += $(npt_sources)
%canon_reldir%_npt_CPPFLAGS        += -I$(top_srcdir)/src

%canon_reldir%_npt_CPPFLAGS        += -I$(top_srcdir)/libnptone
%canon_reldir%_npt_DEPENDENCIES    += libnptone0.la
%canon_reldir%_npt_LDADD           += libnptone0.la

%canon_reldir%_npt_CPPFLAGS        += '-DPROGNAME="npt"'

CLEANFILES                         += npt.log
AM_INSTALLCHECK_STD_OPTIONS_EXEMPT += %reldir%/npt$(EXEEXT)
%canon_reldir%_npt_CFLAGS          += -mwindows
%canon_reldir%_npt_SOURCES         += %reldir%/npt-windows-gui.c

CLEANFILES                              += npt-console.log

# In a perfect world, we would noinst_ npt-console.exe, but as Wine
# does not want to run a PE named *.com, we install the
# npt-console.exe here.

# noinst_PROGRAMS                       += %reldir%/npt-console
bin_PROGRAMS                            += %reldir%/npt-console

AM_INSTALLCHECK_STD_OPTIONS_EXEMPT      += %reldir%/npt-console$(EXEEXT)

%canon_reldir%_npt_console_CFLAGS        =
%canon_reldir%_npt_console_CPPFLAGS      =
%canon_reldir%_npt_console_DEPENDENCIES  =
%canon_reldir%_npt_console_LDADD         =
%canon_reldir%_npt_console_SOURCES       =

%canon_reldir%_npt_console_CPPFLAGS     += '-DPROGNAME="npt-console"'
%canon_reldir%_npt_console_CFLAGS       += -mconsole

%canon_reldir%_npt_console_SOURCES      += $(npt_sources)
%canon_reldir%_npt_console_CPPFLAGS     += -I$(top_srcdir)/src
%canon_reldir%_npt_console_SOURCES      += %reldir%/npt-windows-console.c

%canon_reldir%_npt_console_CPPFLAGS     += -I$(top_srcdir)/libnptone
%canon_reldir%_npt_console_DEPENDENCIES += libnptone0.la
%canon_reldir%_npt_console_LDADD        += libnptone0.la

CLEANFILES                         += %reldir%/npt.com
AM_INSTALLCHECK_STD_OPTIONS_EXEMPT += %reldir%/npt.com
bin_SCRIPTS                        += %reldir%/npt.com

%reldir%/npt.com: %reldir%/npt-console$(EXEEXT)
	cp $^ $@

bin_PROGRAMS                       += %D%/npt-exetype
AM_INSTALLCHECK_STD_OPTIONS_EXEMPT += %D%/npt-exetype
%C%_npt_exetype_CPPFLAGS            =
%C%_npt_exetype_CFLAGS              =
%C%_npt_exetype_CPPFLAGS           += -DPROGNAME='"npt-exetype"'
%C%_npt_exetype_CPPFLAGS           += -DPROGNAMEW='L"npt-exetype"'
%C%_npt_exetype_CFLAGS             += -mconsole
%C%_npt_exetype_SOURCES             = %D%/npt-exetype.c

endif
